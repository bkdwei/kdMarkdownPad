/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
define("vs/editor/diff",["require","exports","vs/base/common/diff/diff"],function(e,t,n){function i(e){if(e.length<=1)return e;var t,n,i,r,s,a,u=[e[0]],l=u[0];for(t=1,n=e.length;n>t;t++)a=e[t],i=a.originalStart-(l.originalStart+l.originalLength),r=a.modifiedStart-(l.modifiedStart+l.modifiedLength),s=Math.min(i,r),o>s?(l.originalLength=a.originalStart+a.originalLength-l.originalStart,l.modifiedLength=a.modifiedStart+a.modifiedLength-l.modifiedStart):(u.push(a),l=a);return u}var r=2e3,o=3,s=function(){function e(e,t,n){this.buffer=e,this.startMarkers=t,this.endMarkers=n}return e.prototype.getLength=function(){return this.startMarkers.length},e.prototype.getElementHash=function(e){return this.buffer.substring(this.startMarkers[e].offset,this.endMarkers[e].offset)},e.prototype.getStartLineNumber=function(e){return e===this.startMarkers.length?this.startMarkers[e-1].lineNumber+1:this.startMarkers[e].lineNumber},e.prototype.getStartColumn=function(e){return this.startMarkers[e].column},e.prototype.getEndLineNumber=function(e){return this.endMarkers[e].lineNumber},e.prototype.getEndColumn=function(e){return this.endMarkers[e].column},e}(),a=function(e){function t(t,n){var i,r,o,s,a,u="",l=[],c=[];for(o=0,i=0,r=t.length;r>i;i++)u+=t[i],s=1,a=t[i].length+1,n&&(s=this._getFirstNonBlankColumn(t[i],1),a=this._getLastNonBlankColumn(t[i],1)),l.push({offset:o+s-1,lineNumber:i+1,column:s}),c.push({offset:o+a-1,lineNumber:i+1,column:a}),o+=t[i].length;e.call(this,u,l,c)}return __extends(t,e),t.prototype._getFirstNonBlankColumn=function(e,t){for(var n=0,i=e.length;i>n;n++)if(" "!==e.charAt(n)&&"  "!==e.charAt(n))return n+1;return t},t.prototype._getLastNonBlankColumn=function(e,t){for(var n=e.length-1;n>=0;n--)if(" "!==e.charAt(n)&&" "!==e.charAt(n))return n+2;return t},t.prototype.getCharSequence=function(e,t){var n,i,r,o,a=[],u=[];for(n=e;t>=n;n++)for(r=this.startMarkers[n],o=this.endMarkers[n],i=r.offset;i<o.offset;i++)a.push({offset:i,lineNumber:r.lineNumber,column:r.column+(i-r.offset)}),u.push({offset:i+1,lineNumber:r.lineNumber,column:r.column+(i-r.offset)+1});return new s(this.buffer,a,u)},t}(s),u=function(){function e(e,t,n){0===e.originalLength?(this.originalStartLineNumber=0,this.originalStartColumn=0,this.originalEndLineNumber=0,this.originalEndColumn=0):(this.originalStartLineNumber=t.getStartLineNumber(e.originalStart),this.originalStartColumn=t.getStartColumn(e.originalStart),this.originalEndLineNumber=t.getEndLineNumber(e.originalStart+e.originalLength-1),this.originalEndColumn=t.getEndColumn(e.originalStart+e.originalLength-1)),0===e.modifiedLength?(this.modifiedStartLineNumber=0,this.modifiedStartColumn=0,this.modifiedEndLineNumber=0,this.modifiedEndColumn=0):(this.modifiedStartLineNumber=n.getStartLineNumber(e.modifiedStart),this.modifiedStartColumn=n.getStartColumn(e.modifiedStart),this.modifiedEndLineNumber=n.getEndLineNumber(e.modifiedStart+e.modifiedLength-1),this.modifiedEndColumn=n.getEndColumn(e.modifiedStart+e.modifiedLength-1))}return e}(),l=function(){function e(e,t,r,o,s){if(0===e.originalLength?(this.originalStartLineNumber=t.getStartLineNumber(e.originalStart)-1,this.originalEndLineNumber=0):(this.originalStartLineNumber=t.getStartLineNumber(e.originalStart),this.originalEndLineNumber=t.getEndLineNumber(e.originalStart+e.originalLength-1)),0===e.modifiedLength?(this.modifiedStartLineNumber=r.getStartLineNumber(e.modifiedStart)-1,this.modifiedEndLineNumber=0):(this.modifiedStartLineNumber=r.getStartLineNumber(e.modifiedStart),this.modifiedEndLineNumber=r.getEndLineNumber(e.modifiedStart+e.modifiedLength-1)),0!==e.originalLength&&0!==e.modifiedLength&&o()){var a=t.getCharSequence(e.originalStart,e.originalStart+e.originalLength-1),l=r.getCharSequence(e.modifiedStart,e.modifiedStart+e.modifiedLength-1),c=new n.LcsDiff(a,l,o),d=c.ComputeDiff();s&&(d=i(d)),this.charChanges=[];for(var h=0,p=d.length;p>h;h++)this.charChanges.push(new u(d[h],a,l))}}return e}(),c=function(){function e(e,t,n,i){this.shouldPostProcessCharChanges=n||!1,this.shouldIgnoreTrimWhitespace=i||!1,this.maximumRunTimeMs=r,this.original=new a(e,this.shouldIgnoreTrimWhitespace),this.modified=new a(t,this.shouldIgnoreTrimWhitespace)}return e.prototype.computeDiff=function(){this.computationStartTime=(new Date).getTime();for(var e=new n.LcsDiff(this.original,this.modified,this._continueProcessingPredicate.bind(this)),t=e.ComputeDiff(),i=[],r=0,o=t.length;o>r;r++)i.push(new l(t[r],this.original,this.modified,this._continueProcessingPredicate.bind(this),this.shouldPostProcessCharChanges));return i},e.prototype._continueProcessingPredicate=function(){if(0===this.maximumRunTimeMs)return!0;var e=(new Date).getTime();return e-this.computationStartTime<this.maximumRunTimeMs},e}();t.DiffComputer=c});
